{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "ADF-PLTDEV-SRPT01"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/DS_ADLS_SFTP_TO_SAP')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_SR_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"filesystem": {
						"type": "string"
					},
					"directory": {
						"type": "string"
					}
				},
				"folder": {
					"name": "DS_CLOROX_SR"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"folderPath": {
							"value": "@dataset().directory",
							"type": "Expression"
						},
						"fileSystem": {
							"value": "@dataset().filesystem",
							"type": "Expression"
						}
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": [
					{
						"name": "Cal. year / month",
						"type": "String"
					},
					{
						"name": "Corp - CustHier1",
						"type": "String"
					},
					{
						"name": "1",
						"type": "String"
					},
					{
						"name": "Subsid - CustHier2",
						"type": "String"
					},
					{
						"name": "2",
						"type": "String"
					},
					{
						"name": "Reg/Div - CustHier3",
						"type": "String"
					},
					{
						"name": "3",
						"type": "String"
					},
					{
						"name": "Sold-to party",
						"type": "String"
					},
					{
						"name": "4",
						"type": "String"
					},
					{
						"name": "Global Category",
						"type": "String"
					},
					{
						"name": "5",
						"type": "String"
					},
					{
						"name": "Brand",
						"type": "String"
					},
					{
						"name": "6",
						"type": "String"
					},
					{
						"name": "EAN/UPC",
						"type": "String"
					},
					{
						"name": "Material",
						"type": "String"
					},
					{
						"name": "7",
						"type": "String"
					},
					{
						"name": "Material Division",
						"type": "String"
					},
					{
						"name": "8",
						"type": "String"
					},
					{
						"name": "Trade Sector",
						"type": "String"
					},
					{
						"name": "9",
						"type": "String"
					},
					{
						"name": "Profit Center",
						"type": "String"
					},
					{
						"name": "10",
						"type": "String"
					},
					{
						"name": "Sales Dept",
						"type": "String"
					},
					{
						"name": "11",
						"type": "String"
					},
					{
						"name": "Sector",
						"type": "String"
					},
					{
						"name": "12",
						"type": "String"
					},
					{
						"name": "Region",
						"type": "String"
					},
					{
						"name": "13",
						"type": "String"
					},
					{
						"name": "Distribution Channel",
						"type": "String"
					},
					{
						"name": "14",
						"type": "String"
					},
					{
						"name": "Broker",
						"type": "String"
					},
					{
						"name": "AC - Invoiced",
						"type": "String"
					},
					{
						"name": "DOS - SC - Invoiced",
						"type": "String"
					},
					{
						"name": "Net Value - Invoiced",
						"type": "String"
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_ADLS_Sustainability')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_SR_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"filesystem": {
						"type": "string"
					},
					"directory": {
						"type": "string"
					},
					"file": {
						"type": "string"
					}
				},
				"folder": {
					"name": "DS_CLOROX_SR"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().file",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().directory",
							"type": "Expression"
						},
						"fileSystem": {
							"value": "@dataset().filesystem",
							"type": "Expression"
						}
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_CSV_to_Parquet_Material_Type')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_SR_ABLB",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"folder": {
						"type": "string"
					},
					"container": {
						"type": "string"
					}
				},
				"folder": {
					"name": "DS_CLOROX_SR"
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"folderPath": {
							"value": "@dataset().folder",
							"type": "Expression"
						},
						"container": {
							"value": "@dataset().container",
							"type": "Expression"
						}
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Reuse_SFTP_PLM')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "LKP_Job_File_Log_Sust_RAW_to_Landing",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Delete_From_Landing",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_location_raw",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_name",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_File_Log_Sust_copy1').output.firstRow.job_file_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_Sustainability",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Update_Records_In_Run_Log_copy1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.exec_status",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@pipeline().parameters.file_transfer_flag",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@pipeline().parameters.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "LKP_Update_Records_In_Run_Log_copy1",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_File_Log_Sust_RAW_to_Landing",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Update ' ,pipeline().parameters.schema,'.',pipeline().parameters.table, ' set records_copied = ' ,activity('Copy_data_Landing_to_Raw_Sust').output.dataWritten , ',' , ' records_read = ' , activity('Copy_data_Landing_to_Raw_Sust').output.dataRead, ' where  job_key = ''' ,pipeline().parameters.job_key,''' and job_run_key = ''' ,pipeline().parameters.job_run_key,'''; Select 0 as DummyValue;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Delete_From_Landing",
						"type": "Delete",
						"dependsOn": [
							{
								"activity": "Copy_data_Landing_to_Raw_Sust",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DS_ABLB_Sustainability",
								"type": "DatasetReference",
								"parameters": {
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_landing",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.file",
										"type": "Expression"
									}
								}
							},
							"enableLogging": false,
							"storeSettings": {
								"type": "AzureBlobStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							}
						}
					},
					{
						"name": "Copy_data_SFTP_to_Landing_Sust",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "SftpReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": {
										"value": "@pipeline().parameters.file_extension",
										"type": "Expression"
									}
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SFTP_EBOM",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().parameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@string(pipeline().parameters.file_name)",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ADLS_PLM_EBOM",
								"type": "DatasetReference",
								"parameters": {
									"filesystem": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_landing",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_File_Log_Sust_copy1",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_data_SFTP_to_Landing_Sust",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_location_landing",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_name",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "Int64",
										"value": null
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_data_Landing_to_Raw_Sust",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_File_Log_Sust_copy1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobStorageReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": {
										"value": "@pipeline().parameters.file_extension",
										"type": "Expression"
									}
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_ABLB_Sustainability",
								"type": "DatasetReference",
								"parameters": {
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_landing",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.file_name",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ABLB_Landing_Sustainability",
								"type": "DatasetReference",
								"parameters": {
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_raw",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Execute_Fail_Alert_Sust",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_data_SFTP_to_Landing_Sust",
								"dependencyConditions": [
									"Failed"
								]
							},
							{
								"activity": "Copy_data_Landing_to_Raw_Sust",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@pipeline().parameters.job_key",
									"type": "Expression"
								}
							}
						}
					}
				],
				"parameters": {
					"container": {
						"type": "string"
					},
					"directory_raw": {
						"type": "string"
					},
					"file": {
						"type": "string"
					},
					"schema": {
						"type": "string"
					},
					"table": {
						"type": "string"
					},
					"job_key": {
						"type": "string"
					},
					"job_run_key": {
						"type": "string"
					},
					"action_update": {
						"type": "string"
					},
					"exec_status": {
						"type": "string"
					},
					"file_transfer_flag": {
						"type": "string"
					},
					"file_location_raw": {
						"type": "string"
					},
					"file_name": {
						"type": "string"
					},
					"file_size": {
						"type": "string"
					},
					"job_file_key": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string"
					},
					"file_location_landing": {
						"type": "string"
					},
					"directory_landing": {
						"type": "string"
					},
					"file_extension": {
						"type": "string",
						"defaultValue": ".csv"
					}
				},
				"folder": {
					"name": "Reusable Pipeline"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-17T11:04:52Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Reuse_SFTP_PLM_updated')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "LKP_Job_File_Log_Sust_RAW_to_Landing",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Delete_From_Landing",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"datafactory_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_location_landing",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_name",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "Int64",
										"value": {
											"value": "@activity('LKP_Job_File_Log_Sust_copy1').output.firstRow.job_file_key",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"pipeline_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"pipeline_run_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"pipeline_trigger_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"pipeline_trigger_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_Sustainability",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Job_File_Log_Sust_RAW_to_Landing",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.exec_status",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@pipeline().parameters.file_transfer_flag",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@pipeline().parameters.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Delete_From_Landing",
						"type": "Delete",
						"dependsOn": [
							{
								"activity": "Copy_data_Landing_to_Raw_Sust",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DS_ABLB_Sustainability",
								"type": "DatasetReference",
								"parameters": {
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_landing",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.file",
										"type": "Expression"
									}
								}
							},
							"enableLogging": false,
							"storeSettings": {
								"type": "AzureBlobStorageReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							}
						}
					},
					{
						"name": "Copy_data_SFTP_to_Landing_Sust",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "SftpReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": {
										"value": "@pipeline().parameters.file_extension",
										"type": "Expression"
									}
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SFTP_EBOM",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().parameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@string(pipeline().parameters.file_name)",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ADLS_PLM_EBOM",
								"type": "DatasetReference",
								"parameters": {
									"filesystem": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_landing",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_File_Log_Sust_copy1",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_data_SFTP_to_Landing_Sust",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"datafactory_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_location_landing",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_name",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "Int64",
										"value": null
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"pipeline_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"pipeline_run_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"pipeline_trigger_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"pipeline_trigger_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_data_Landing_to_Raw_Sust",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_File_Log_Sust_copy1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobStorageReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": {
										"value": "@pipeline().parameters.file_extension",
										"type": "Expression"
									}
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_ABLB_Sustainability",
								"type": "DatasetReference",
								"parameters": {
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_landing",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.file_name",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ABLB_Landing_Sustainability",
								"type": "DatasetReference",
								"parameters": {
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_raw",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Execute_Fail_Alert_Sust",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_data_SFTP_to_Landing_Sust",
								"dependencyConditions": [
									"Failed"
								]
							},
							{
								"activity": "Copy_data_Landing_to_Raw_Sust",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@pipeline().parameters.job_key",
									"type": "Expression"
								}
							}
						}
					}
				],
				"parameters": {
					"container": {
						"type": "string"
					},
					"directory_raw": {
						"type": "string"
					},
					"file": {
						"type": "string"
					},
					"schema": {
						"type": "string"
					},
					"table": {
						"type": "string"
					},
					"job_key": {
						"type": "string"
					},
					"job_run_key": {
						"type": "string"
					},
					"action_update": {
						"type": "string"
					},
					"exec_status": {
						"type": "string"
					},
					"file_transfer_flag": {
						"type": "string"
					},
					"file_location_raw": {
						"type": "string"
					},
					"file_name": {
						"type": "string"
					},
					"file_size": {
						"type": "string"
					},
					"job_file_key": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string"
					},
					"file_location_landing": {
						"type": "string"
					},
					"directory_landing": {
						"type": "string"
					},
					"file_extension": {
						"type": "string",
						"defaultValue": ".csv"
					}
				},
				"folder": {
					"name": "Reusable Pipeline"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-18T10:37:35Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_Adhoc_Exclusion_File_Target_Table_to_Curated_ADLS')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_Exclusion_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_exclusion",
							"value": {
								"value": "@variables('job_name_exclusion_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_Exclusion_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_exclusion_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_Exclusion",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where exclusion_file_name = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "seq_id",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "seq_id",
											"type": "Int64",
											"physicalType": "INT_64"
										}
									},
									{
										"source": {
											"name": "tradeunit",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "tradeunit",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_spec",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "material_spec",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "material_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_division",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_division",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "point_person",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "point_person",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "notes",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "notes",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "created_db_timestamp",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "created_db_timestamp",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "last_modified_db_timestamp",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_modified_db_timestamp",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "exclusion_file_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "exclusion_file_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "hashkey",
											"type": "Byte[]",
											"physicalType": "varbinary"
										},
										"sink": {
											"name": "hashkey",
											"type": "Byte[]",
											"physicalType": "BINARY"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_Exclusion",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "LKP_Update_Records_In_Run_Log",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Update ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_run_log, ' set records_copied = ' , activity('Copy_from_Stg_to_Curated').output.rowsCopied ,  ',' ,  ' records_read = ' , activity('Copy_from_Stg_to_Curated').output.rowsRead , ' where  job_key = ' , activity('LKP_Job_Key_Exclusion').output.firstRow.job_key, ' and job_run_key =' , activity('LKP_Job_Run_Log_Exclusion').output.firstRow.job_run_key, ';select 0 as DummyValue;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_Material",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Update_Records_In_Run_Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Run_Log_Exclusion').output.firstRow.job_run_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file_log"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "rnd"
					},
					"table": {
						"type": "string",
						"defaultValue": "material_exclusion"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/Adhoc_Files/Exclusion"
					},
					"action_insert": {
						"type": "string",
						"defaultValue": "insert"
					},
					"exec_status": {
						"type": "string",
						"defaultValue": "In Progress"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_ftp": {
						"type": "string"
					},
					"directory_ftp_archive": {
						"type": "string"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_exclusion_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_Exclusion_File"
					},
					"job_name_exclusion": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-17T11:04:52Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_Adhoc_Exclusion_File_Target_Table_to_Curated_ADLS_copy1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_Exclusion_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_exclusion",
							"value": {
								"value": "@variables('job_name_exclusion_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_Exclusion_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_exclusion_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_Exclusion",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where substitution_file_name = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "seq_id",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "seq_id",
											"type": "Int64",
											"physicalType": "INT_64"
										}
									},
									{
										"source": {
											"name": "material_spec",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "material_spec",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "material_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_division",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_division",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_pcr",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "material_pcr",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "material_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "material_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "point_person",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "point_person",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "notes",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "notes",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "create_timestamp",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "create_timestamp",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "last_modified_timestamp",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_modified_timestamp",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "substitution_file_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "substitution_file_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "hashkey",
											"type": "Byte[]",
											"physicalType": "varbinary"
										},
										"sink": {
											"name": "hashkey",
											"type": "Byte[]",
											"physicalType": "BINARY"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_Exclusion",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "LKP_Update_Records_In_Run_Log",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Update ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_run_log, ' set records_copied = ' , activity('Copy_from_Stg_to_Curated').output.rowsCopied ,  ',' ,  ' records_read = ' , activity('Copy_from_Stg_to_Curated').output.rowsRead , ' where  job_key = ' , activity('LKP_Job_Key_Exclusion').output.firstRow.job_key, ' and job_run_key =' , activity('LKP_Job_Run_Log_Exclusion').output.firstRow.job_run_key, ';select 0 as DummyValue;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_Material",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Update_Records_In_Run_Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Run_Log_Exclusion').output.firstRow.job_run_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file_log"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "rnd"
					},
					"table": {
						"type": "string",
						"defaultValue": "material_substitution"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/Adhoc_Files/Substitution"
					},
					"action_insert": {
						"type": "string",
						"defaultValue": "insert"
					},
					"exec_status": {
						"type": "string",
						"defaultValue": "In Progress"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_ftp": {
						"type": "string"
					},
					"directory_ftp_archive": {
						"type": "string"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_exclusion_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_Substitution_File"
					},
					"job_name_exclusion": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-17T11:04:52Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_Adhoc_Files_Target_Table_to_Curated')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_Exclusion_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_exclusion",
							"value": {
								"value": "@pipeline().parameters.job_name_exclusion_value",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_Exclusion_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',pipeline().parameters.job_name_exclusion_value,'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_Exclusion",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where ', pipeline().parameters.file_name_query, '=''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"value": "@json(pipeline().parameters.mapping_dynamic)",
								"type": "Expression"
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_Exclusion",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "LKP_Update_Records_In_Run_Log",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Update ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_run_log, ' set records_copied = ' , activity('Copy_from_Stg_to_Curated').output.rowsCopied ,  ',' ,  ' records_read = ' , activity('Copy_from_Stg_to_Curated').output.rowsRead , ' where  job_key = ' , activity('LKP_Job_Key_Exclusion').output.firstRow.job_key, ' and job_run_key =' , activity('LKP_Job_Run_Log_Exclusion').output.firstRow.job_run_key, ';select 0 as DummyValue;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_Material",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Update_Records_In_Run_Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Run_Log_Exclusion').output.firstRow.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file_log"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "rnd"
					},
					"table": {
						"type": "string"
					},
					"container": {
						"type": "string"
					},
					"action_insert": {
						"type": "string",
						"defaultValue": "insert"
					},
					"exec_status": {
						"type": "string",
						"defaultValue": "In Progress"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_ftp": {
						"type": "string"
					},
					"directory_ftp_archive": {
						"type": "string"
					},
					"job_file_key": {
						"type": "string"
					},
					"job_name_exclusion_value": {
						"type": "string"
					},
					"mapping_dynamic": {
						"type": "string"
					},
					"file_name_query": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_exclusion": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "Reusable Pipeline"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-17T12:57:50Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_Adhoc_Files_Target_Table_to_Curated_Updated')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_Exclusion_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_exclusion",
							"value": {
								"value": "@pipeline().parameters.job_name_exclusion_value",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_Exclusion_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',pipeline().parameters.job_name_exclusion_value,'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_Exclusion",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where ', pipeline().parameters.file_name_query, '=''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"value": "@json(pipeline().parameters.mapping_dynamic)",
								"type": "Expression"
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_Exclusion",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_Material",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_Exclusion",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Run_Log_Exclusion').output.firstRow.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									},
									"datafactory_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"pipeline_trigger_time": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"pipeline_trigger_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"pipeline_run_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"pipeline_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_Exclusion').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "control_etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "rnd"
					},
					"table": {
						"type": "string"
					},
					"container": {
						"type": "string"
					},
					"action_insert": {
						"type": "string",
						"defaultValue": "insert"
					},
					"exec_status": {
						"type": "string",
						"defaultValue": "In Progress"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_ftp": {
						"type": "string"
					},
					"directory_ftp_archive": {
						"type": "string"
					},
					"job_file_key": {
						"type": "string"
					},
					"job_name_exclusion_value": {
						"type": "string"
					},
					"mapping_dynamic": {
						"type": "string"
					},
					"file_name_query": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_exclusion": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "Reusable Pipeline"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-18T12:56:46Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_EBOM_Staging_Table_to_Curated_ADLS')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_EBOM_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_ebom",
							"value": {
								"value": "@variables('job_name_ebom_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_EBOM",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_EBOM_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_ebom_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_EBOM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where ebom_file_name = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "seq_id",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "seq_id",
											"type": "Int64",
											"physicalType": "INT_64"
										}
									},
									{
										"source": {
											"name": "level",
											"type": "String",
											"physicalType": "char"
										},
										"sink": {
											"name": "level",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "relation_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "relation_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "from_or_to",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "from_or_to",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_type",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_part",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_part",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_specification",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_specification",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_quantity",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "material_quantity",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "material_uom",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_uom",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_division",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_division",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "revision",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "revision",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "recyclable_plastic_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "recyclable_plastic_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "recycle_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "recycle_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "package_reuse_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "package_reuse_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "compostable_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "compostable_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "plastic_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "plastic_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "country_of_origin",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "country_of_origin",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "certification_type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "certification_type",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "created_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "created_date",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "last_modified_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_modified_date",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "created_db_timestamp",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "created_db_timestamp",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "last_modified_db_timestamp",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_modified_db_timestamp",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "ebom_file_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "ebom_file_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "hashkey",
											"type": "Byte[]",
											"physicalType": "varbinary"
										},
										"sink": {
											"name": "hashkey",
											"type": "Byte[]",
											"physicalType": "BINARY"
										}
									},
									{
										"source": {
											"name": "cdc_flag",
											"type": "String",
											"physicalType": "char"
										},
										"sink": {
											"name": "cdc_flag",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "parent",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "parent",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_EBOM",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_EBOM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_EBOM').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "LKP_Update_Records_In_Run_Log",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Update ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_run_log, ' set records_copied = ' , activity('Copy_from_Stg_to_Curated').output.rowsCopied ,  ',' ,  ' records_read = ' , activity('Copy_from_Stg_to_Curated').output.rowsRead , ' where  job_key = ' , activity('LKP_Job_Key_EBOM').output.firstRow.job_key, ' and job_run_key =' , activity('LKP_Job_Run_Log_EBOM').output.firstRow.job_run_key, ';select 0 as DummyValue;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_EBOM",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Update_Records_In_Run_Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_EBOM').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_EBOM",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_EBOM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_EBOM').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Run_Log_EBOM').output.firstRow.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_EBOM').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Move_EBOM_File_to_Archive_SFTP",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Update_Job_File_Log_EBOM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "SftpReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "SftpWriteSettings",
									"operationTimeout": "01:00:00",
									"useTempFileRename": true
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_SFTP_Files",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp_archive",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Delete_EBOM_File_From_SFTP",
						"type": "Delete",
						"dependsOn": [
							{
								"activity": "Move_EBOM_File_to_Archive_SFTP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							},
							"enableLogging": false,
							"storeSettings": {
								"type": "SftpReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file_log"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "tmp"
					},
					"table": {
						"type": "string",
						"defaultValue": "stg_ebom"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/PLM/EBOM"
					},
					"action_insert": {
						"type": "string"
					},
					"exec_status": {
						"type": "string"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/"
					},
					"directory_sftp_archive": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/Archive/"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_ebom_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_EBOM"
					},
					"job_name_ebom": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-17T11:04:52Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_EBOM_Staging_Table_to_Curated_ADLS_Updated')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_EBOM_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_ebom",
							"value": {
								"value": "@variables('job_name_ebom_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_EBOM",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_EBOM_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_ebom_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_EBOM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where ebom_file_name = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "seq_id",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "seq_id",
											"type": "Int64",
											"physicalType": "INT_64"
										}
									},
									{
										"source": {
											"name": "level",
											"type": "String",
											"physicalType": "char"
										},
										"sink": {
											"name": "level",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "relation_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "relation_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "from_or_to",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "from_or_to",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_type",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_part",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_part",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_specification",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_specification",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_quantity",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "material_quantity",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "material_uom",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_uom",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_division",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_division",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "revision",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "revision",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "recyclable_plastic_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "recyclable_plastic_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "recycle_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "recycle_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "package_reuse_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "package_reuse_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "compostable_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "compostable_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "plastic_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "plastic_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "country_of_origin",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "country_of_origin",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "certification_type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "certification_type",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "created_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "created_date",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "last_modified_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_modified_date",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "created_db_timestamp",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "created_db_timestamp",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "last_modified_db_timestamp",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_modified_db_timestamp",
											"type": "DateTime",
											"physicalType": "INT_96"
										}
									},
									{
										"source": {
											"name": "ebom_file_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "ebom_file_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "hashkey",
											"type": "Byte[]",
											"physicalType": "varbinary"
										},
										"sink": {
											"name": "hashkey",
											"type": "Byte[]",
											"physicalType": "BINARY"
										}
									},
									{
										"source": {
											"name": "cdc_flag",
											"type": "String",
											"physicalType": "char"
										},
										"sink": {
											"name": "cdc_flag",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "parent",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "parent",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_EBOM",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_EBOM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_EBOM').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_EBOM",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_EBOM').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_EBOM",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_EBOM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_EBOM').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Run_Log_EBOM').output.firstRow.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									},
									"datafactory_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"pipeline_trigger_time": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"pipeline_trigger_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"pipeline_run_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"pipeline_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_EBOM').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Move_EBOM_File_to_Archive_SFTP",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Update_Job_File_Log_EBOM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "SftpReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "SftpWriteSettings",
									"operationTimeout": "01:00:00",
									"useTempFileRename": true
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_SFTP_Files",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp_archive",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Delete_EBOM_File_From_SFTP",
						"type": "Delete",
						"dependsOn": [
							{
								"activity": "Move_EBOM_File_to_Archive_SFTP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							},
							"enableLogging": false,
							"storeSettings": {
								"type": "SftpReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "control_etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "tmp"
					},
					"table": {
						"type": "string",
						"defaultValue": "stg_ebom"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/PLM/EBOM"
					},
					"action_insert": {
						"type": "string"
					},
					"exec_status": {
						"type": "string"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/"
					},
					"directory_sftp_archive": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/Archive/"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_ebom_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_EBOM"
					},
					"job_name_ebom": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-18T12:48:13Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_Material_Type_Target_Table_to_Curated_ADLS')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_Materail_Type_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_material",
							"value": {
								"value": "@variables('job_name_material_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_Material",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_Materail_Type_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_material_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where material_type_filename = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "material_type_categorization",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_type_categorization",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "part_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "part_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_type_filename",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_type_filename",
											"type": "String",
											"physicalType": "UTF8"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_Material",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Material').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "LKP_Update_Records_In_Run_Log",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Update ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_run_log, ' set records_copied = ' , activity('Copy_from_Stg_to_Curated').output.rowsCopied ,  ',' ,  ' records_read = ' , activity('Copy_from_Stg_to_Curated').output.rowsRead , ' where  job_key = ' , activity('LKP_Job_Key_Material').output.firstRow.job_key, ' and job_run_key =' , pipeline().parameters.job_run_key, ';select 0 as DummyValue;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_Material",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Update_Records_In_Run_Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_Material').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_Material",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Material').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_Material').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Move_Material_File_to_Archive_SFTP",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Update_Job_File_Log_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "SftpReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "SftpWriteSettings",
									"operationTimeout": "01:00:00",
									"useTempFileRename": true
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_SFTP_Files",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp_archive",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Delete_Material_File_From_SFTP",
						"type": "Delete",
						"dependsOn": [
							{
								"activity": "Move_Material_File_to_Archive_SFTP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							},
							"enableLogging": false,
							"storeSettings": {
								"type": "SftpReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file_log"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "rnd"
					},
					"table": {
						"type": "string",
						"defaultValue": "material_type"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/Material_Type"
					},
					"action_insert": {
						"type": "string",
						"defaultValue": "insert"
					},
					"exec_status": {
						"type": "string",
						"defaultValue": "In Progress"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/"
					},
					"directory_sftp_archive": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/Archive"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_material_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_Material_Type"
					},
					"job_name_material": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-17T11:04:52Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_Material_Type_Target_Table_to_Curated_ADLS_Updated')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_Materail_Type_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_material",
							"value": {
								"value": "@variables('job_name_material_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_Material",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_Materail_Type_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_material_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where material_type_filename = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "material_type_categorization",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_type_categorization",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "part_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "part_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_type_filename",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_type_filename",
											"type": "String",
											"physicalType": "UTF8"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_Material",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Material').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_Material",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_Material').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_Material",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Material').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									},
									"datafactory_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"pipeline_trigger_time": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"pipeline_trigger_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"pipeline_run_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"pipeline_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_Material').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Move_Material_File_to_Archive_SFTP",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Update_Job_File_Log_Material",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "SftpReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "SftpWriteSettings",
									"operationTimeout": "01:00:00",
									"useTempFileRename": true
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_SFTP_Files",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp_archive",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Delete_Material_File_From_SFTP",
						"type": "Delete",
						"dependsOn": [
							{
								"activity": "Move_Material_File_to_Archive_SFTP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							},
							"enableLogging": false,
							"storeSettings": {
								"type": "SftpReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "control_etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "rnd"
					},
					"table": {
						"type": "string",
						"defaultValue": "material_type"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/Material_Type"
					},
					"action_insert": {
						"type": "string",
						"defaultValue": "insert"
					},
					"exec_status": {
						"type": "string",
						"defaultValue": "In Progress"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/"
					},
					"directory_sftp_archive": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/Archive"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_material_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_Material_Type"
					},
					"job_name_material": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-18T13:21:55Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_SAP_File_Staging_Table_to_Curated_ADLS')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_SAP_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_sap",
							"value": {
								"value": "@variables('job_name_sap_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_sap",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_SAP_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_sap_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_SAP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where sap_filename = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "customer_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "customer_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "customer_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "customer_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "corporate_custhier1",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "corporate_custhier1",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "corp_custhier1_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "corp_custhier1_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "subsidiary_custhier2",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "subsidiary_custhier2",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "subs_custhier2_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "subs_custhier2_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "reg_div_custhier3",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "reg_div_custhier3",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "reg_div_custhier3_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "reg_div_custhier3_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "broker_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "broker_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "broker_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "broker_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "profit_center",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "profit_center",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "profit_center_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "profit_center_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "division_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "division_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_division_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_division_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "global_category",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "global_category",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "global_category_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "global_category_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "brand_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "brand_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "brand_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "brand_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "purpose_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "purpose_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "purpose_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "purpose_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "type_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "type_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "type_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "type_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "package_size",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "package_size",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "package_size_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "package_size_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "european_article_numbers_universal_product_code",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "european_article_numbers_universal_product_code",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "region_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "region_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "regional_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "regional_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_organization",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_organization",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_organization_decsription",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_organization_decsription",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "trade_sector",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "trade_sector",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "trade_sector_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "trade_sector_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "country_key",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "country_key",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "country_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "country_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_department_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_department_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_department_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_department_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sector_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sector_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sector_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sector_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "controlling_area",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "controlling_area",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "controlling_area_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "controlling_area_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "distribution_channel",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "distribution_channel",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "distribution_channel_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "distribution_channel_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "calendar_year",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "calendar_year",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "calendar_year_month",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "calendar_year_month",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "calendar_month",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "calendar_month",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "fiscal_year",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "fiscal_year",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "posting_period",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "posting_period",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "fiscal_year_variant",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "fiscal_year_variant",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "base_unit_of_measure_uom",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "base_unit_of_measure_uom",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "quantity_in_base_units_of_measure",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "quantity_in_base_units_of_measure",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "base_unit_of_measure_uom2",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "base_unit_of_measure_uom2",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "dos_quantity",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "dos_quantity",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "statistics_currency",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "statistics_currency",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "net_value_statistics_currency",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "net_value_statistics_currency",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sap_filename",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sap_filename",
											"type": "String",
											"physicalType": "UTF8"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_SAP",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_sap",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "LKP_Update_Records_In_Run_Log",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Update ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_run_log, ' set records_copied = ' , activity('Copy_from_Stg_to_Curated').output.rowsCopied ,  ',' ,  ' records_read = ' , activity('Copy_from_Stg_to_Curated').output.rowsRead , ' where  job_key = ' , activity('LKP_Job_Key_SAP').output.firstRow.job_key, ' and job_run_key =' , pipeline().parameters.job_run_key, ';select 0 as DummyValue;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_SAP",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Update_Records_In_Run_Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_SAP",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_SAP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file_log"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "tmp"
					},
					"table": {
						"type": "string",
						"defaultValue": "stg_sap_bw"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/SAP"
					},
					"action_insert": {
						"type": "string",
						"defaultValue": "insert"
					},
					"exec_status": {
						"type": "string",
						"defaultValue": "In Progress"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/"
					},
					"directory_sftp_archive": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/Archive"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_sap_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_SAP"
					},
					"job_name_sap": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-17T11:04:52Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_SAP_File_Staging_Table_to_Curated_ADLS_Updated')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_SAP_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_sap",
							"value": {
								"value": "@variables('job_name_sap_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_sap",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_SAP_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_sap_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_SAP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where sap_filename = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "customer_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "customer_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "customer_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "customer_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "corporate_custhier1",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "corporate_custhier1",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "corp_custhier1_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "corp_custhier1_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "subsidiary_custhier2",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "subsidiary_custhier2",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "subs_custhier2_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "subs_custhier2_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "reg_div_custhier3",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "reg_div_custhier3",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "reg_div_custhier3_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "reg_div_custhier3_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "broker_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "broker_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "broker_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "broker_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "profit_center",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "profit_center",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "profit_center_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "profit_center_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "division_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "division_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_division_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_division_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "global_category",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "global_category",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "global_category_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "global_category_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "brand_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "brand_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "brand_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "brand_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "purpose_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "purpose_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "purpose_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "purpose_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "type_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "type_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "type_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "type_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "package_size",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "package_size",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "package_size_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "package_size_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "european_article_numbers_universal_product_code",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "european_article_numbers_universal_product_code",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "region_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "region_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "regional_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "regional_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_organization",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_organization",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_organization_decsription",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_organization_decsription",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "trade_sector",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "trade_sector",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "trade_sector_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "trade_sector_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "country_key",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "country_key",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "country_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "country_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_department_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_department_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_department_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_department_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sector_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sector_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sector_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sector_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "controlling_area",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "controlling_area",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "controlling_area_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "controlling_area_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "distribution_channel",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "distribution_channel",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "distribution_channel_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "distribution_channel_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "calendar_year",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "calendar_year",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "calendar_year_month",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "calendar_year_month",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "calendar_month",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "calendar_month",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "fiscal_year",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "fiscal_year",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "posting_period",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "posting_period",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "fiscal_year_variant",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "fiscal_year_variant",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "base_unit_of_measure_uom",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "base_unit_of_measure_uom",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "quantity_in_base_units_of_measure",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "quantity_in_base_units_of_measure",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "base_unit_of_measure_uom2",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "base_unit_of_measure_uom2",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "dos_quantity",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "dos_quantity",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "statistics_currency",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "statistics_currency",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "net_value_statistics_currency",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "net_value_statistics_currency",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sap_filename",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sap_filename",
											"type": "String",
											"physicalType": "UTF8"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_SAP",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_sap",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_SAP",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_SAP",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_SAP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									},
									"datafactory_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"pipeline_trigger_time": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"pipeline_trigger_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"pipeline_run_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"pipeline_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "control_etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "tmp"
					},
					"table": {
						"type": "string",
						"defaultValue": "stg_sap_bw"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/SAP"
					},
					"action_insert": {
						"type": "string",
						"defaultValue": "insert"
					},
					"exec_status": {
						"type": "string",
						"defaultValue": "In Progress"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/"
					},
					"directory_sftp_archive": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/Archive"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_sap_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_SAP"
					},
					"job_name_sap": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-18T15:01:30Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_SAP_Hub_Staging_Table_to_Curated_ADLS')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_SAP_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_sap",
							"value": {
								"value": "@variables('job_name_sap_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_sap",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_SAP_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_sap_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_SAP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where sap_filename = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "customer_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "customer_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "customer_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "customer_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "corporate_custhier1",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "corporate_custhier1",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "corp_custhier1_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "corp_custhier1_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "subsidiary_custhier2",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "subsidiary_custhier2",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "subs_custhier2_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "subs_custhier2_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "reg_div_custhier3",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "reg_div_custhier3",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "reg_div_custhier3_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "reg_div_custhier3_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "broker_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "broker_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "broker_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "broker_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "profit_center",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "profit_center",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "profit_center_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "profit_center_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "division_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "division_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_division_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_division_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "global_category",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "global_category",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "global_category_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "global_category_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "brand_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "brand_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "brand_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "brand_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "purpose_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "purpose_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "purpose_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "purpose_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "type_number",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "type_number",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "type_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "type_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "package_size",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "package_size",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "package_size_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "package_size_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "european_article_numbers_universal_product_code",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "european_article_numbers_universal_product_code",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "region_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "region_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "regional_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "regional_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_organization",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_organization",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_organization_decsription",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_organization_decsription",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "trade_sector",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "trade_sector",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "trade_sector_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "trade_sector_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "country_key",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "country_key",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "country_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "country_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_department_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_department_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sales_department_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_department_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sector_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sector_in_sales_dept_hierarchy",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sector_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sector_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "controlling_area",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "controlling_area",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "controlling_area_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "controlling_area_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "distribution_channel",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "distribution_channel",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "distribution_channel_description",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "distribution_channel_description",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "calendar_year",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "calendar_year",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "calendar_year_month",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "calendar_year_month",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "calendar_month",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "calendar_month",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "fiscal_year",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "fiscal_year",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "posting_period",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "posting_period",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "fiscal_year_variant",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "fiscal_year_variant",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "base_unit_of_measure_uom",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "base_unit_of_measure_uom",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "quantity_in_base_units_of_measure",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "quantity_in_base_units_of_measure",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "base_unit_of_measure_uom2",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "base_unit_of_measure_uom2",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "dos_quantity",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "dos_quantity",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "statistics_currency",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "statistics_currency",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "net_value_statistics_currency",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "net_value_statistics_currency",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sap_filename",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sap_filename",
											"type": "String",
											"physicalType": "UTF8"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_SAP",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_sap",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "LKP_Update_Records_In_Run_Log",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Update ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_run_log, ' set records_copied = ' , activity('Copy_from_Stg_to_Curated').output.rowsCopied ,  ',' ,  ' records_read = ' , activity('Copy_from_Stg_to_Curated').output.rowsRead , ' where  job_key = ' , activity('LKP_Job_Key_SAP').output.firstRow.job_key, ' and job_run_key =' , pipeline().parameters.job_run_key, ';select 0 as DummyValue;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_SAP",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Update_Records_In_Run_Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_SAP",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_SAP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_SAP').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file_log"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "tmp"
					},
					"table": {
						"type": "string",
						"defaultValue": "stg_sap_hub"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/SAP"
					},
					"action_insert": {
						"type": "string",
						"defaultValue": "insert"
					},
					"exec_status": {
						"type": "string",
						"defaultValue": "In Progress"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/"
					},
					"directory_sftp_archive": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/Archive"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_sap_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_SAP"
					},
					"job_name_sap": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-17T11:04:52Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_Sustainability_Staging_Table_to_Curated_ADLS')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_Sustainability_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_sust",
							"value": {
								"value": "@variables('job_name_sust_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_Sustainability",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_Sustainability_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_sust_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_Sustainability",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where sustainability_file_name = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "level",
											"type": "String",
											"physicalType": "char"
										},
										"sink": {
											"name": "level",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "relation_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "relation_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "from_or_to",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "from_or_to",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_type",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_spec",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_spec",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_part_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_part_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "material_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "material_uom",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_uom",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_pcr",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "material_pcr",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "revision",
											"type": "String",
											"physicalType": "char"
										},
										"sink": {
											"name": "revision",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sustainability_file_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sustainability_file_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_Sustainability",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_Sustainability",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Sustainability').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "LKP_Update_Records_In_Run_Log",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Update ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_run_log, ' set records_copied = ' , activity('Copy_from_Stg_to_Curated').output.rowsCopied ,  ',' ,  ' records_read = ' , activity('Copy_from_Stg_to_Curated').output.rowsRead , ' where  job_key = ' , activity('LKP_Job_Key_Sustainability').output.firstRow.job_key, ' and job_run_key =' , pipeline().parameters.job_run_key, ';select 0 as DummyValue;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_Sustainability",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Update_Records_In_Run_Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_Sustainability').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_Sustainability",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_Sustainability",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Sustainability').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_Sustainability').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Move_Sustainability_File_to_Archive_SFTP",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Update_Job_File_Log_Sustainability",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "SftpReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "SftpWriteSettings",
									"operationTimeout": "01:00:00",
									"useTempFileRename": true
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_SFTP_Files",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp_archive",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Delete_Sustainability_File_From_SFTP",
						"type": "Delete",
						"dependsOn": [
							{
								"activity": "Move_Sustainability_File_to_Archive_SFTP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							},
							"enableLogging": false,
							"storeSettings": {
								"type": "SftpReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file_log"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "tmp"
					},
					"table": {
						"type": "string",
						"defaultValue": "stg_sustainability"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/PLM/Sustainability"
					},
					"action_insert": {
						"type": "string"
					},
					"exec_status": {
						"type": "string"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/"
					},
					"directory_sftp_archive": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/Archive/"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_sust_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_Sustainability"
					},
					"job_name_sust": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-17T11:04:52Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_Tran_Sustainability_Staging_Table_to_Curated_ADLS_Updated')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PF_Sustainability_Job_Name",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "job_name_sust",
							"value": {
								"value": "@variables('job_name_sust_value')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "LKP_Job_Key_Sustainability",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PF_Sustainability_Job_Name",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select job_key from ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_control,' where job_name=''',variables('job_name_sust_value'),'''')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_from_Stg_to_Curated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_Run_Log_Sustainability",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select * from ', pipeline().parameters.schema_stg,'.',pipeline().parameters.table, ' where sustainability_file_name = ''' , pipeline().parameters.filename,''' ;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "level",
											"type": "String",
											"physicalType": "char"
										},
										"sink": {
											"name": "level",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "relation_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "relation_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "from_or_to",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "from_or_to",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_type",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_spec",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_spec",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_part_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_part_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_weight",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "material_weight",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "material_uom",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "material_uom",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "material_pcr",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "material_pcr",
											"type": "Double",
											"physicalType": "DOUBLE"
										}
									},
									{
										"source": {
											"name": "revision",
											"type": "String",
											"physicalType": "char"
										},
										"sink": {
											"name": "revision",
											"type": "String",
											"physicalType": "UTF8"
										}
									},
									{
										"source": {
											"name": "sustainability_file_name",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sustainability_file_name",
											"type": "String",
											"physicalType": "UTF8"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SQL_Lnd",
								"type": "DatasetReference",
								"parameters": {
									"schema": {
										"value": "@pipeline().parameters.schema_stg",
										"type": "Expression"
									},
									"table": {
										"value": "@pipeline().parameters.table",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_CSV_to_Parquet_Material_Type",
								"type": "DatasetReference",
								"parameters": {
									"folder": {
										"value": "@concat(formatDateTime(utcnow(),'yyyy'),'/',formatDateTime(utcnow(),'MM'),'/',formatDateTime(utcnow(),'dd'))",
										"type": "Expression"
									},
									"container": {
										"value": "@pipeline().parameters.container",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_Run_Log_Sustainability",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_Key_Sustainability",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
								"storedProcedureParameters": {
									"ADF_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"file_transfer_flag": {
										"type": "String",
										"value": {
											"value": "@variables('file_transfer_flag')",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Sustainability').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_start_date_time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"last_update_date": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"Pipeline_Name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"Pipeline_Start_Time": {
										"type": "DateTime",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"PL_Run_ID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"Action": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.action_insert",
											"type": "Expression"
										}
									},
									"Execution_Status": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.exec_status",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Job_Run_Status_Sustainability",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[Rnd].[USP_Insert_Job_Run]",
							"storedProcedureParameters": {
								"Action": {
									"value": {
										"value": "@pipeline().parameters.action_update",
										"type": "Expression"
									},
									"type": "String"
								},
								"ADF_Name": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"Execution_Status": {
									"value": {
										"value": "@pipeline().parameters.run_status_pass",
										"type": "Expression"
									},
									"type": "String"
								},
								"file_transfer_flag": {
									"value": {
										"value": "@variables('file_transfer_flag')",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@activity('LKP_Job_Key_Sustainability').output.firstRow.job_key",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_start_date_time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"last_update_date": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"Pipeline_Name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"Pipeline_Start_Time": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PL_Run_ID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Update_Job_File_Log_Sustainability",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "SP_Job_Run_Status_Sustainability",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.container",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.filename",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_Key_Sustainability').output.firstRow.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_file_key",
											"type": "Expression"
										}
									},
									"datafactory_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"pipeline_trigger_time": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"pipeline_trigger_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"pipeline_run_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"pipeline_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Execute_Fail_Alert",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Copy_from_Stg_to_Curated",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Fail_Alert",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"job_key": {
									"value": "@activity('LKP_Job_Key_Sustainability').output.firstRow.job_key",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Move_Sustainability_File_to_Archive_SFTP",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Update_Job_File_Log_Sustainability",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "SftpReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "SftpWriteSettings",
									"operationTimeout": "01:00:00",
									"useTempFileRename": true
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_SFTP_Files",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp_archive",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Delete_Sustainability_File_From_SFTP",
						"type": "Delete",
						"dependsOn": [
							{
								"activity": "Move_Sustainability_File_to_Archive_SFTP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "DS_SFTP_Files_copy1",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().globalParameters.directory_sftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.filename",
										"type": "Expression"
									}
								}
							},
							"enableLogging": false,
							"storeSettings": {
								"type": "SftpReadSettings",
								"recursive": true,
								"enablePartitionDiscovery": false
							}
						}
					}
				],
				"parameters": {
					"schema": {
						"type": "string",
						"defaultValue": "control_etl"
					},
					"table_job_control": {
						"type": "string",
						"defaultValue": "job_control"
					},
					"table_job_run_log": {
						"type": "string",
						"defaultValue": "job_run_log"
					},
					"table_job_file_log": {
						"type": "string",
						"defaultValue": "job_file"
					},
					"filesystem_adls": {
						"type": "string",
						"defaultValue": "clx-datalake"
					},
					"job_run_key": {
						"type": "string"
					},
					"filename": {
						"type": "string"
					},
					"schema_stg": {
						"type": "string",
						"defaultValue": "tmp"
					},
					"table": {
						"type": "string",
						"defaultValue": "stg_sustainability"
					},
					"container": {
						"type": "string",
						"defaultValue": "clx-datalake/Curated/RnD/PLM/Sustainability"
					},
					"action_insert": {
						"type": "string"
					},
					"exec_status": {
						"type": "string"
					},
					"action_update": {
						"type": "string",
						"defaultValue": "update"
					},
					"run_status_pass": {
						"type": "string",
						"defaultValue": "Success"
					},
					"run_status_failed": {
						"type": "string",
						"defaultValue": "Failed"
					},
					"email_url": {
						"type": "string",
						"defaultValue": "https://prod-51.eastus2.logic.azure.com:443/workflows/ceda425476814f708eb7cc9d5367112a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VK3vUyZ1Fxy6PdExFQAekhkbehfXiU6f9tEztB4qy-c"
					},
					"file_size": {
						"type": "string"
					},
					"directory_sftp": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/"
					},
					"directory_sftp_archive": {
						"type": "string",
						"defaultValue": "/home/svcrndreporting/Archive/"
					},
					"job_file_key": {
						"type": "string"
					}
				},
				"variables": {
					"job_name_sust_value": {
						"type": "String",
						"defaultValue": "Archive_and_Load_Sustainability"
					},
					"job_name_sust": {
						"type": "String"
					},
					"job_key": {
						"type": "String"
					},
					"file_transfer_flag": {
						"type": "String",
						"defaultValue": "Y"
					}
				},
				"folder": {
					"name": "PL_ClOROX_SR"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-18T12:48:13Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_CSV_to_Parquet_Material_Type')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Pl_Reuse_FTP_Adhoc_Files')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Copy_data_FTP_to_Landing",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "ExcelSource",
								"storeSettings": {
									"type": "FtpReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false,
									"useBinaryTransfer": true
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": {
										"value": "@pipeline().parameters.file_extension",
										"type": "Expression"
									}
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_FTP_All_Files",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().parameters.directory_ftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.file_name",
										"type": "Expression"
									},
									"sheet_name": {
										"value": "@pipeline().parameters.sheet",
										"type": "Expression"
									},
									"range": {
										"value": "@pipeline().parameters.range",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ADLS_PLM_EBOM_copy2",
								"type": "DatasetReference",
								"parameters": {
									"filesystem": {
										"value": "@pipeline().parameters.filesystem_adls",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_adhoc_files",
										"type": "Expression"
									},
									"filename": {
										"value": "@pipeline().parameters.filename_concat",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_File_Log",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_data_FTP_to_Landing",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_location",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_name",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": null
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_data_Landing_Temp_Table",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_File_Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"additionalColumns": [
									{
										"name": "file_name",
										"value": {
											"value": "@pipeline().parameters.file_name",
											"type": "Expression"
										}
									}
								],
								"storeSettings": {
									"type": "AzureBlobStorageReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "AzureSqlSink",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"enableSkipIncompatibleRow": true,
							"logSettings": {
								"enableCopyActivityLog": true,
								"copyActivityLogSettings": {
									"logLevel": "Warning",
									"enableReliableLogging": false
								},
								"logLocationSettings": {
									"linkedServiceName": {
										"referenceName": "LS_SR_ABLB",
										"type": "LinkedServiceReference"
									},
									"path": "clx-datalake/Raw/RnD/Files"
								}
							},
							"translator": {
								"value": "@json(pipeline().parameters.json_mapping)",
								"type": "Expression"
							}
						},
						"inputs": [
							{
								"referenceName": "DS_ABLB_Sustainability",
								"type": "DatasetReference",
								"parameters": {
									"container": {
										"value": "@pipeline().parameters.filesystem_adls",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_adhoc_files",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.file_name",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_SQL_FTP_Files",
								"type": "DatasetReference",
								"parameters": {
									"table": {
										"value": "@pipeline().parameters.table_name_adhoc",
										"type": "Expression"
									},
									"schema": {
										"value": "@pipeline().parameters.schema_ftp",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_File_Log_RAW_to_DB",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_data_Landing_Temp_Table",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.directory_ftp",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_name",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_File_Log').output.firstRow.job_file_key",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "LKP_Update_Record_Landing_Table",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "LKP_Job_File_Log_RAW_to_DB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Update ' ,pipeline().parameters.schema,'.',pipeline().parameters.table_job_run_log, ' set records_copied = ' , activity('Copy_data_Landing_Temp_Table').output.rowsCopied ,  ',' ,  ' records_read = ' , activity('Copy_data_Landing_Temp_Table').output.rowsRead , ' where  job_key = ' , pipeline().parameters.job_key, ' and job_run_key =' , pipeline().parameters.job_run_key, ';select 0 as DummyValue;')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Temp_Table_to_Rnd",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Update_Record_Landing_Table",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": {
								"value": "@pipeline().parameters.stored_procedure",
								"type": "Expression"
							},
							"storedProcedureParameters": {
								"file_name": {
									"value": {
										"value": "@pipeline().parameters.file_name",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@pipeline().parameters.job_key",
										"type": "Expression"
									},
									"type": "Int64"
								},
								"job_run_key": {
									"value": {
										"value": "@pipeline().parameters.job_run_key",
										"type": "Expression"
									},
									"type": "Int64"
								},
								"message": {
									"value": null,
									"type": "String"
								},
								"status": {
									"value": null,
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					}
				],
				"parameters": {
					"file_location": {
						"type": "string"
					},
					"file_name": {
						"type": "string"
					},
					"file_size": {
						"type": "string"
					},
					"job_key": {
						"type": "string"
					},
					"job_run_key": {
						"type": "string"
					},
					"directory_ftp": {
						"type": "string"
					},
					"sheet": {
						"type": "string"
					},
					"range": {
						"type": "string"
					},
					"filesystem_adls": {
						"type": "string"
					},
					"directory_adhoc_files": {
						"type": "string"
					},
					"file_name_concat": {
						"type": "string"
					},
					"table_name_adhoc": {
						"type": "string"
					},
					"schema_ftp": {
						"type": "string"
					},
					"json_mapping": {
						"type": "string"
					},
					"schema": {
						"type": "string"
					},
					"table_job_run_log": {
						"type": "string"
					},
					"table_job_file_log": {
						"type": "string"
					},
					"table_job_control": {
						"type": "string"
					},
					"stored_procedure": {
						"type": "string"
					},
					"filename_concat": {
						"type": "string"
					},
					"file_extension": {
						"type": "string"
					},
					"additional_file_name": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Reusable Pipeline"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-17T12:14:23Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Pl_Reuse_FTP_Adhoc_Files_Updated')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Copy_data_FTP_to_Landing",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "ExcelSource",
								"storeSettings": {
									"type": "FtpReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false,
									"useBinaryTransfer": true
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": {
										"value": "@pipeline().parameters.file_extension",
										"type": "Expression"
									}
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_FTP_All_Files",
								"type": "DatasetReference",
								"parameters": {
									"directory": {
										"value": "@pipeline().parameters.directory_ftp",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.file_name",
										"type": "Expression"
									},
									"sheet_name": {
										"value": "@pipeline().parameters.sheet",
										"type": "Expression"
									},
									"range": {
										"value": "@pipeline().parameters.range",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ADLS_PLM_EBOM_copy2",
								"type": "DatasetReference",
								"parameters": {
									"filesystem": {
										"value": "@pipeline().parameters.filesystem_adls",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_adhoc_files",
										"type": "Expression"
									},
									"filename": {
										"value": "@pipeline().parameters.filename_concat",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_File_Log",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_data_FTP_to_Landing",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_location",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_name",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": null
									},
									"datafactory_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"pipeline_trigger_time": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"pipeline_trigger_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"pipeline_run_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"pipeline_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "Copy_data_Landing_Temp_Table",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "LKP_Job_File_Log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"additionalColumns": [
									{
										"name": "file_name",
										"value": {
											"value": "@pipeline().parameters.file_name",
											"type": "Expression"
										}
									}
								],
								"storeSettings": {
									"type": "AzureBlobStorageReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "AzureSqlSink",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"enableSkipIncompatibleRow": true,
							"logSettings": {
								"enableCopyActivityLog": true,
								"copyActivityLogSettings": {
									"logLevel": "Warning",
									"enableReliableLogging": false
								},
								"logLocationSettings": {
									"linkedServiceName": {
										"referenceName": "LS_SR_ABLB",
										"type": "LinkedServiceReference"
									},
									"path": "clx-datalake/Raw/RnD/Files"
								}
							},
							"translator": {
								"value": "@json(pipeline().parameters.json_mapping)",
								"type": "Expression"
							}
						},
						"inputs": [
							{
								"referenceName": "DS_ABLB_Sustainability",
								"type": "DatasetReference",
								"parameters": {
									"container": {
										"value": "@pipeline().parameters.filesystem_adls",
										"type": "Expression"
									},
									"directory": {
										"value": "@pipeline().parameters.directory_adhoc_files",
										"type": "Expression"
									},
									"file": {
										"value": "@pipeline().parameters.file_name",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_SQL_FTP_Files",
								"type": "DatasetReference",
								"parameters": {
									"table": {
										"value": "@pipeline().parameters.table_name_adhoc",
										"type": "Expression"
									},
									"schema": {
										"value": "@pipeline().parameters.schema_ftp",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "LKP_Job_File_Log_RAW_to_DB",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy_data_Landing_Temp_Table",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[Rnd].[USP_Job_File_Log]",
								"storedProcedureParameters": {
									"file_location": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.directory_ftp",
											"type": "Expression"
										}
									},
									"file_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_name",
											"type": "Expression"
										}
									},
									"file_size": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.file_size",
											"type": "Expression"
										}
									},
									"job_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_key",
											"type": "Expression"
										}
									},
									"job_run_key": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.job_run_key",
											"type": "Expression"
										}
									},
									"job_file_key": {
										"type": "String",
										"value": {
											"value": "@activity('LKP_Job_File_Log').output.firstRow.job_file_key",
											"type": "Expression"
										}
									},
									"datafactory_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"pipeline_trigger_time": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerTime",
											"type": "Expression"
										}
									},
									"pipeline_trigger_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"pipeline_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"pipeline_run_id": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_LND_STG_ADMIN",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "SP_Temp_Table_to_Rnd",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LKP_Job_File_Log_RAW_to_DB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": {
								"value": "@pipeline().parameters.stored_procedure",
								"type": "Expression"
							},
							"storedProcedureParameters": {
								"file_name": {
									"value": {
										"value": "@pipeline().parameters.file_name",
										"type": "Expression"
									},
									"type": "String"
								},
								"job_key": {
									"value": {
										"value": "@pipeline().parameters.job_key",
										"type": "Expression"
									},
									"type": "Int64"
								},
								"job_run_key": {
									"value": {
										"value": "@pipeline().parameters.job_run_key",
										"type": "Expression"
									},
									"type": "Int64"
								},
								"message": {
									"value": null,
									"type": "String"
								},
								"status": {
									"value": null,
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_AzureSQDb_Admin",
							"type": "LinkedServiceReference"
						}
					}
				],
				"parameters": {
					"file_location": {
						"type": "string"
					},
					"file_name": {
						"type": "string"
					},
					"file_size": {
						"type": "string"
					},
					"job_key": {
						"type": "string"
					},
					"job_run_key": {
						"type": "string"
					},
					"directory_ftp": {
						"type": "string"
					},
					"sheet": {
						"type": "string"
					},
					"range": {
						"type": "string"
					},
					"filesystem_adls": {
						"type": "string"
					},
					"directory_adhoc_files": {
						"type": "string"
					},
					"file_name_concat": {
						"type": "string"
					},
					"table_name_adhoc": {
						"type": "string"
					},
					"schema_ftp": {
						"type": "string"
					},
					"json_mapping": {
						"type": "string"
					},
					"schema": {
						"type": "string"
					},
					"table_job_run_log": {
						"type": "string"
					},
					"table_job_file_log": {
						"type": "string"
					},
					"table_job_control": {
						"type": "string"
					},
					"stored_procedure": {
						"type": "string"
					},
					"filename_concat": {
						"type": "string"
					},
					"file_extension": {
						"type": "string"
					},
					"additional_file_name": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Reusable Pipeline"
				},
				"annotations": [],
				"lastPublishTime": "2021-06-18T13:55:34Z"
			},
			"dependsOn": []
		}
	]
}